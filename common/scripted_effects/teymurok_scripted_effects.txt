remove_excess_corpses = {
    if = {
        limit = {
            has_country_flag = no_fridge
            check_variable = {
                which = teymurok_human_bodies_collected
                value = 100
            }
        }
        set_variable = {
            which = teymurok_human_bodies_collected
            value = 100
        }
    }

    else_if = {
        limit = {
            has_country_flag = small_fridge
            check_variable = {
                which = teymurok_human_bodies_collected
                value = 500
            }
        }
        set_variable = {
            which = teymurok_human_bodies_collected
            value = 500
        }
    }
}

prepare_variables_for_spending = {
		export_to_variable = {
			which = tey_small_global_economy
			value = total_development
		}

		multiply_variable = {
    		which = tey_small_global_economy
    		value = 0.25
		}

		export_to_variable = {
			which = tey_big_global_economy
			value = total_development
		}

		multiply_variable = {
    		which = tey_big_global_economy
    		value = 0.5
		}

		if = {
			limit = { has_country_flag = spending_shlak }
			export_to_variable = {
				which = tey_small_local_economy
				value = total_development
			}

			multiply_variable = {
    			which = tey_small_local_economy
    			value = 0.25
			}

			export_to_variable = {
				which = tey_big_local_economy
				value = total_development
			}

			multiply_variable = {
    			which = tey_big_local_economy
    			value = 0.5
			}
		}
		else = {
			export_to_variable = {
				which = tey_small_local_economy
				value = total_development
			}

			divide_variable  = {
    			which = tey_small_local_economy
    			value = 16
			}

			export_to_variable = {
				which = tey_big_local_economy
				value = total_development
			}

			multiply_variable = {
    			which = tey_big_local_economy
    			value = 0.125
			}
		}

		export_to_variable = {
			which = tey_small_army
			value = army_size
		}

		export_to_variable = {
			which = tey_big_army
			value = army_size
		}

		multiply_variable = {
    		which = tey_big_army
    		value = 2
		}

		if = {
			limit = {
				mil_tech = 16
			}
			set_variable = {
				which = tey_extreme_army
				value = 80
			}
		}

		else_if = {
			limit = {
				mil_tech = 12
			}
			set_variable = {
				which = tey_extreme_army
				value = 60
			}
		}

		else = {
			set_variable = {
				which = tey_extreme_army
				value = 40
			}
		}
}

remove_extreme_modifiers = {
    remove_country_modifier = tey_centaur_army_extreme
    remove_country_modifier = tey_elf_army_extreme
    remove_country_modifier = tey_gnoll_army_extreme
    remove_country_modifier = tey_gnome_army_extreme
    remove_country_modifier = tey_goblin_army_extreme
    remove_country_modifier = tey_harimari_army_extreme
    remove_country_modifier = tey_hobgoblin_army_extreme
    remove_country_modifier = tey_kobold_army_extreme
    remove_country_modifier = tey_ogre_army_extreme
    remove_country_modifier = tey_orc_army_extreme
}

remove_corpses_army = {
    subtract_variable = {
        which = teymurok_$races$_bodies_collected
        which = tey_$var$_army
    }
}

remove_corpses_local_economy = {
    subtract_variable = {
        which = teymurok_$races$_bodies_collected
        which = tey_$var$_local_economy
    }
}

remove_corpses_global_economy = {
    subtract_variable = {
        which = teymurok_$races$_bodies_collected
        which = tey_$var$_global_economy
    }
}

add_small_local_economy = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_local_economy_small_tt
		if = {
			limit = { NOT = { is_enough_corpses_local_economy = { races = $race$ var = small } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = {
				NOT = {
					num_of_owned_provinces_with = {
						value = 1
						is_$goods$_good = yes
					}
				}
			}
			custom_tooltip = no_trade_good_tt
		}
		if = {
			limit = {
				is_enough_corpses_local_economy = { races = $race$ var = small }
				any_owned_province = {
					is_$goods$_good = yes
					NOT = {
						has_province_modifier = tey_small_$type$_goods
						has_province_modifier = tey_big_$type$_goods
					}
				}
			}
			custom_tooltip = tey_local_small_$goods$_tt
			custom_tooltip = all_small_prolonged_big_untouched_tt
			hidden_effect = {
				every_owned_province = {
					limit ={
						is_$goods$_good = yes
						NOT = {
							has_province_modifier = tey_big_$type$_goods
						}
					}
						if = {
							limit = {
								has_province_modifier = tey_small_$type$_goods
							}
							remove_province_modifier = tey_small_$type$_goods
						}
						add_province_modifier = {
							name = tey_small_$type$_goods
							duration = 3650
						}
				}
			}
			hidden_effect = { remove_corpses_local_economy = { var = small races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_big_local_economy = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_local_economy_big_tt
		if = {
			limit = { NOT = { is_enough_corpses_local_economy = { races = $race$ var = big } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = {
				NOT = {
					num_of_owned_provinces_with = {
						value = 1
						is_$goods$_good = yes
					}
				}
			}
			custom_tooltip = no_trade_good_tt
		}
		if = {
			limit = {
				is_enough_corpses_local_economy = { races = $race$ var = big }
				any_owned_province = {
					is_$goods$_good = yes
					NOT = {
						has_province_modifier = tey_big_$type$_goods
					}
				}
			}
			custom_tooltip = tey_local_big_$goods$_tt
			hidden_effect = {
				every_owned_province = {
					limit = {
						is_$goods$_good = yes
					}
					if = {
						limit = {
							has_province_modifier = tey_small_$type$_goods
						}
						remove_province_modifier = tey_small_$type$_goods
					}
					if = {
						limit = {
							has_province_modifier = tey_big_$type$_goods
						}
						remove_province_modifier = tey_big_$type$_goods
					}
						add_province_modifier = {
							name = tey_big_$type$_goods
							duration = 3650
						}
				}
			}
			hidden_effect = { remove_corpses_local_economy = { var = big races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_small_global_economy = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_global_economy_small_tt
		if = {
			limit = { NOT = { is_enough_corpses_global_economy = { var = small races = $race$ } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = {
				OR = {
					has_country_modifier = tey_small_$modifier$
					has_country_modifier = tey_big_$modifier$
				}
			}
			custom_tooltip = tey_this_or_better_modifier_tt
		}
		if = {
			limit = {
				is_enough_corpses_global_economy = { var = small races = $race$ }
				NOT = { has_country_modifier = tey_small_$modifier$ }
				NOT = { has_country_modifier = tey_big_$modifier$ }
			}
			add_country_modifier = {
				name = tey_small_$modifier$
				duration = 3650
			}
			hidden_effect = { remove_corpses_global_economy = { var = small races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_big_global_economy = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_global_economy_big_tt
		if = {
			limit = { NOT = { is_enough_corpses_global_economy = { var = big races = $race$ } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = { has_country_modifier = tey_big_$modifier$ }
			custom_tooltip = tey_this_modifier_tt
		}
		if = {
			limit = {
				is_enough_corpses_global_economy = { var = big races = $race$ }
				NOT = { has_country_modifier = tey_big_$modifier$ }
			}
			if = { limit = { has_country_modifier = tey_small_$modifier$ }
				remove_country_modifier = tey_small_$modifier$	
			}
			add_country_modifier = {
				name = tey_big_$modifier$
				duration = 3650
			}
			hidden_effect = { remove_corpses_global_economy = { var = big races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_small_army = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_army_small_tt
		if = {
			limit = { NOT = { is_enough_corpses_army = { var = small races = $race$} } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = {
				OR = {
					has_country_modifier = tey_small_$modifier$
					has_country_modifier = tey_big_$modifier$
				}
			}
			custom_tooltip = tey_this_or_better_modifier_tt
		}
		if = {
			limit = {
				is_enough_corpses_army = { var = small races = $race$ }
				NOT = { has_country_modifier = tey_small_$modifier$ }
				NOT = { has_country_modifier = tey_big_$modifier$ }
			}
			add_country_modifier = {
				name = tey_small_$modifier$
				duration = 3650
			}
			hidden_effect = { remove_corpses_army = { var = small races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_big_army = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_army_big_tt
		if = {
			limit = { NOT = { is_enough_corpses_army = { var = big races = $race$ } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = { has_country_modifier = tey_big_$modifier$ }
			custom_tooltip = tey_this_modifier_tt
		}
		if = {
			limit = {
				is_enough_corpses_army = { var = big races = $race$ }
				NOT = { has_country_modifier = tey_big_$modifier$ }
			}
			if = { limit = { has_country_modifier = tey_small_$modifier$ }
				remove_country_modifier = tey_small_$modifier$	
			}
			add_country_modifier = {
				name = tey_big_$modifier$
				duration = 3650
			}
			hidden_effect = { remove_corpses_army = { var = big races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}

add_extreme_army = {
	custom_tooltip = $race$_corpse_amount_tt
	custom_tooltip = corpse_army_extreme_tt
		if = {
			limit = { NOT = { is_enough_corpses_army = { var = extreme races = $race$ } } }
			custom_tooltip = tey_not_enough_corpses_tt
		}
		if = {
			limit = { has_country_modifier = tey_extreme_$modifier$ }
			custom_tooltip = tey_this_modifier_tt
		}
		if = {
			limit = {
				is_enough_corpses_army = { var = extreme races = $race$ }
				NOT = { has_country_modifier = tey_extreme_$modifier$ }
			}
			custom_tooltip = tey_extreme_army_tt
			add_country_modifier = {
				name = tey_extreme_$modifier$
				duration = 365
			}
			hidden_effect = { remove_corpses_army = { var = extreme races = $race$ } }
		}
		if = {
			limit = { has_country_flag = spending_shlak }
			hidden_effect = { country_event = { id = flavor_teymurok.200 } }
		}
		if = {
			limit = { has_country_flag = spending_special }
			hidden_effect = { country_event = { id = flavor_teymurok.204 } }
		}
}